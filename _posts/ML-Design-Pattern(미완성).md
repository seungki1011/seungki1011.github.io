## Design Pattern

### 디자인 패턴이란?

* 문제를 해결하는 방법을 패턴화 해서 표현
* 반복적으로 발생하는 문제를 어떻게 해결할지에 대한 솔루션
* 추상회된 패턴
* 개발할 때 구조화된 패턴을 설명하는 용어
* 안티 패턴 : 좋지 않은 패턴

* 우리가 처음 개발할 때는 main.py, inference.py, predict.py, utils.py 등.. 간단하게 시작함
* 점점 규모가 커지면, 하나의 시스템에 여러 역할이 필요한 경우가 존재
* 복잡한 비즈니스 로직을 해결하기 위해 코드 아키텍처도 잘 설계하는 것이 필요



## ML Design Pattern

### 머신 러닝 디자인 패턴 소개

* 일반적인 개발 디자인 패턴에도 포함할 수 있지만, 머신러닝 특수성으로 별도의 디자인 패턴이 생김
* 머신러닝의 특수성 
  * Data, Model, Code
* 학습, 예측, 운영하면서 생기는 노하우 -> 패턴화
* 상황 마다의 Best Case가 다름(디자인 패턴은 하나의 지침서로 활용하면 됨)



### 4가지 패턴 소개

#### 1. Serving Pattern

* 모델을 Production 환경에 서빙하는 패턴
* Online Serving, Batch Serving도 패턴 중 하나 

##### Web Single Pattern

* 가장 간단한 아키텍쳐
* 예측 서버를 빠르게 출시하고 싶은 경우
* FastAPI, Flask 등으로 단일 REST 인터페이스 생성
* 요청시 전처리도 포함
* 간단하게 생성할 수 있는 구조

###### 장점

* 하나의 프로그래밍 언어로 진행
* 단순함
* 처음 사용할 때 좋은 방식

###### 단점

* 구성 요소가 하나가 바뀌면 전체 업데이트 해야함

##### Synchronous Pattern

* 예측의 결과에 따라 로직이 달라지는 경우
  * 예측 결과가 강아지 -> 강아지 관련 화면, 고양이면 -> 고양이 관련 화면
* 예측이 끝날 때 까지 프로세스를 block
* REST API는 대부분 Syncronous 패턴

###### 장점

* 단순함
* 예측이 완료될 때까지 프로세스가 다른 작업을 할 필요가 없어서 workflow가 단순함

###### 단점

* 예측 속도가 병목이 됨(동시에 1000개의 요청이 올 경우 대기 시간)
* 예측 지연으로 인한 사용자 경험 악화



##### Asynchronous Pattern

* 예측과 진행 프로세스의 의존성이 없는 경우
* 비동기로 실행됨, 예측 요청을 하고 응답을 바로 받을 필요가 없는 경우
* 예측을 요청하는 클라이언트와 응답을 반환하는 목적지가 분리된 경우
* 클라이언트와 예측 서버 사이에 메세지 시스템(queue) 추가
* 특정 메세지에 Request 데이터를 메세지 Queue에 저장(push)
* 특정 서버는 메세지 Queue의 데이터를 가져와서 예측(pull)

###### 장점

* 클라이언트 예측을 분리
* 클라이언트가 예측을 기다릴 필요가 없음

###### 단점

* 메세지 Queue 시스템을 만들어야 함
* 실시간 예측에는 적절하지 않음





#### 2. Training Pattern

* 모델을 학습하는 패턴

#### 3. QA Pattern

* 모델의 성능을 Production 환경에서 평가하기 위한 패턴

#### 4. Operation Pattern

* 모델을 운영하기 위한 패턴



